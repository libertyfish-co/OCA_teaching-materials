## 12.3 Ruby on Rails：ECサイトの開発 セッションと複数商品の注文3

### 12.3.1 複数明細の購入・管理への変更

12.2まではセッションを利用してカート機能を実装しました。この章では、複数商品へ対応した購入処理と管理画面の修正を行います。

### 12.3.2 複数明細の購入

ユーザーがカートに入った複数商品を一括購入できる機能を実装しましょう。カートはセッションを参照していますので、それらを注文(Order)テーブルに置き換える必要があります

Orderモデルはすでにあるものを利用します。新しく追加するOrderDetailモデルとの関係性は下の図のとおりです。

![画像](images/12-3-1-1.png)

実装方法がイメージできない場合は、以下のステップを参考に実装してみてください。

#### (c) 問題

##### ステップ c-1) 複数明細の購入処理テーブルの準備
- 一括で購入登録ができるように、OrderDetailモデルに個数管理を行うカラム（integer、初期値0）を追加

##### ステップ c-2) 複数明細の一括購入処理への変更
- Ordersコントローラのnew,confirm,createメソッドで単一購入から複数購入できるように変更
- カート一覧画面に「購入する」ボタンを追加してリクエストをorders#newにする
- Orderモデルに合計金額を表示するためのtotal_price、合計個数を表示するためのtotal_numberを実装
- OrderDetailモデルに商品の小計金額を表示するためのtotal_priceを実装
- 購入登録画面（orders#new）で複数の商品の情報が扱えるように修正
- 購入登録結果メールで複数の商品の情報が扱えるように修正
